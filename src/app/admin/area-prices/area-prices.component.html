<div class="simple-container">
    <div class="simple-header">
        <button (click)="goBack()" class="simple-back-btn">
            ← Quay lại
        </button>
        <div class="header-content">
            <h1>Quản lý Giá Theo Khu Vực</h1>
            <p>Chọn khu vực để quản lý giá món ăn</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="simple-content">
        <div class="price-layout">
            <!-- Left Panel - Areas List -->
            <div class="areas-panel">
                <h2>Danh sách khu vực</h2>

                <!-- Loading State for Areas -->
                @if (loading()) {
                <div class="simple-loading">
                    <div class="simple-spinner"></div>
                    <p>Đang tải...</p>
                </div>
                }

                <!-- Error State for Areas -->
                @if (error()) {
                <div class="simple-error">
                    {{ error() }}
                </div>
                }

                <!-- Areas List -->
                @if (areas().length > 0) {
                <div class="areas-list">
                    @for (area of areas(); track area.areaId) {
                    <div class="area-item" [class.selected]="selectedArea()?.areaId === area.areaId"
                        (click)="selectArea(area)">
                        <div class="area-info">
                            <h3>{{ area.areaName }}</h3>
                            <span class="area-status" [class]="area.isActive ? 'active' : 'inactive'">
                                {{ area.isActive ? 'Hoạt động' : 'Không hoạt động' }}
                            </span>
                        </div>
                        <span class="area-arrow">›</span>
                    </div>
                    }
                </div>
                }

                <!-- Empty State for Areas -->
                @if (areas().length === 0 && !loading()) {
                <div class="simple-empty">
                    <h4>Chưa có khu vực nào</h4>
                </div>
                }
            </div>

            <!-- Right Panel - Dish Prices -->
            <div class="dishes-panel">
                @if (!selectedArea()) {
                <!-- No Area Selected -->
                <div class="simple-empty">
                    <h3>Chọn khu vực để xem món ăn</h3>
                    <p>Vui lòng chọn một khu vực từ danh sách bên trái</p>
                </div>
                } @else {
                <!-- Selected Area Header -->
                <div class="panel-header">
                    <h2>Món ăn trong {{ selectedArea()?.areaName }}</h2>
                    <p>Quản lý giá món ăn cho khu vực này</p>
                </div>

                <!-- Loading State for Dishes -->
                @if (loadingDishes()) {
                <div class="simple-loading">
                    <div class="simple-spinner"></div>
                    <p>Đang tải danh sách món ăn...</p>
                </div>
                }

                <!-- Error State for Dishes -->
                @if (dishError()) {
                <div class="simple-error">
                    {{ dishError() }}
                </div>
                }

                <!-- Dish Prices List -->
                @if (dishPrices().length > 0 && !loadingDishes()) {
                <div class="dishes-grid">
                    @for (dishPrice of dishPrices(); track dishPrice.id) {
                    <div class="dish-card">
                        <div class="dish-header">
                            <h4>{{ dishPrice.dishName || 'Món ăn #' + dishPrice.dishId }}</h4>
                            <span class="dish-status" [class]="dishPrice.isActive ? 'active' : 'inactive'">
                                {{ dishPrice.isActive ? 'Hoạt động' : 'Không hoạt động' }}
                            </span>
                        </div>

                        <div class="dish-info">
                            <div class="price-info">
                                <div class="current-price">
                                    <span class="label">Giá khu vực:</span>
                                    <span class="value">{{ dishPrice.customPrice | currency:'VND':'symbol':'1.0-0'
                                        }}</span>
                                </div>
                                @if (dishPrice.basePrice) {
                                <div class="base-price">
                                    <span class="label">Giá gốc:</span>
                                    <span class="value">{{ dishPrice.basePrice | currency:'VND':'symbol':'1.0-0'
                                        }}</span>
                                </div>
                                }
                            </div>
                            <div class="dish-date">
                                <span>{{ dishPrice.effectiveDate | date:'dd/MM/yyyy' }}</span>
                            </div>
                        </div>

                        <div class="dish-actions">
                            <button class="simple-btn edit-btn" (click)="openEditModal(dishPrice)">
                                Sửa giá
                            </button>
                            <button class="simple-btn quantity-btn"
                                (click)="openQuantityModal(dishPrice, 'e6847093-5ccb-417e-b49f-67630cc26386')">
                                Đổi SL
                            </button>
                            <button class="simple-btn delete-btn"
                                (click)="openRemoveModal(dishPrice, 'e6847093-5ccb-417e-b49f-67630cc26386')">
                                Xóa
                            </button>
                        </div>
                    </div>
                    }
                </div>
                }

                <!-- Empty State for Dishes -->
                @if (dishPrices().length === 0 && !loadingDishes() && !dishError()) {
                <div class="simple-empty">
                    <h3>Chưa có món ăn nào</h3>
                    <p>Khu vực này chưa có món ăn được cấu hình giá.</p>
                </div>
                }
                }
            </div>
        </div>
    </div>

    <!-- Edit Price Modal -->
    @if (showEditModal()) {
    <div class="simple-modal-overlay" (click)="closeEditModal()">
        <div class="simple-modal" (click)="$event.stopPropagation()">
            <h3>Chỉnh sửa giá</h3>

            @if (editingDish()) {
            <div class="modal-info">
                <p class="dish-name">{{ editingDish()?.dishName }}</p>
                <p class="area-name">{{ selectedArea()?.areaName }}</p>
            </div>
            }

            <form (ngSubmit)="updatePrice()">
                <div class="form-group">
                    <label>Giá mới (VND)</label>
                    <input type="number" [(ngModel)]="newPrice" name="newPrice" placeholder="0" min="0" required>
                </div>

                <div class="modal-actions">
                    <button type="button" (click)="closeEditModal()" class="simple-btn cancel-btn"
                        [disabled]="updatingPrice()">
                        Hủy
                    </button>
                    <button type="submit" class="simple-btn submit-btn"
                        [disabled]="updatingPrice() || !newPrice() || newPrice() < 0">
                        {{ updatingPrice() ? 'Đang lưu...' : 'Lưu' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
    }

    <!-- Quantity Modal -->
    @if (showQuantityModal()) {
    <div class="simple-modal-overlay" (click)="closeQuantityModal()">
        <div class="simple-modal" (click)="$event.stopPropagation()">
            <h3>Thay đổi số lượng</h3>

            @if (editingQuantity()) {
            <div class="modal-info">
                <p class="dish-name">{{ editingQuantity()?.dishName }}</p>
                <p class="order-id">Order ID: {{ currentOrderId() }}</p>
            </div>
            }

            <form (ngSubmit)="changeQuantity()">
                <div class="form-group">
                    <label>Số lượng mới</label>
                    <input type="number" [(ngModel)]="newQuantity" name="newQuantity" placeholder="1" min="1" max="999"
                        required>
                </div>

                <div class="modal-actions">
                    <button type="button" (click)="closeQuantityModal()" class="simple-btn cancel-btn"
                        [disabled]="updatingQuantity()">
                        Hủy
                    </button>
                    <button type="submit" class="simple-btn submit-btn"
                        [disabled]="updatingQuantity() || !newQuantity() || newQuantity() < 1">
                        {{ updatingQuantity() ? 'Đang cập nhật...' : 'Cập nhật' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
    }

    <!-- Remove Food Modal -->
    @if (showRemoveModal()) {
    <div class="simple-modal-overlay" (click)="closeRemoveModal()">
        <div class="simple-modal" (click)="$event.stopPropagation()">
            <h3>Xác nhận xóa món</h3>

            @if (removingDish()) {
            <div class="modal-info">
                <p class="dish-name">{{ removingDish()?.dishName }}</p>
                <p class="order-id">Order ID: {{ currentOrderId() }}</p>
                <p class="warning">Món ăn sẽ bị xóa hoàn toàn khỏi order!</p>
            </div>
            }

            <div class="modal-actions">
                <button (click)="closeRemoveModal()" class="simple-btn cancel-btn" [disabled]="removingFood()">
                    Hủy
                </button>
                <button (click)="removeFood()" class="simple-btn delete-btn" [disabled]="removingFood()">
                    {{ removingFood() ? 'Đang xóa...' : 'Xóa món' }}
                </button>
            </div>
        </div>
    </div>
    }
</div>