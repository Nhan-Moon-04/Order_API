<div class="order-dashboard">
    <!-- Left Panel - Order Details + Menu (50% width) -->
    <div class="order-panel">
        <!-- Order Details Section (50% height) -->
        <div class="order-details-section">
            <!-- Header -->
            <div class="order-header">
                <div class="flex items-center justify-between">
                    <a (click)="goBack()" class="back-btn cursor-pointer">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Back
                    </a>
                    <div class="text-center">
                        <h1 class="text-xl font-bold">CHI TIẾT BÀN</h1>
                    </div>
                    <div class="w-16"></div>
                </div>
            </div>

            @if (loading()) {
            <div class="text-center py-8">
                <div class="spinner-border text-blue-500"></div>
                <p class="mt-2 text-gray-600">Đang tải...</p>
            </div>
            }

            @if (error()) {
            <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700 mb-4">
                {{ error() }}
            </div>
            }

            @if (order()) {
            <!-- Order Items Table -->
            <div class="order-items-container mt-4">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" class="text-center" style="width: 5%">#</th>
                                <th scope="col" style="width: 30%">Tên món</th>
                                <th scope="col" class="text-center" style="width: 15%">Số lượng</th>
                                <th scope="col" class="text-end" style="width: 12%">Giá</th>
                                <th scope="col" class="text-end" style="width: 12%">Giảm giá</th>
                                <th scope="col" class="text-end" style="width: 12%">Thuế</th>
                                <th scope="col" class="text-end" style="width: 12%">Thành tiền</th>
                                <th scope="col" class="text-center" style="width: 5%">Xóa</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (item of order()?.orderDetails; track item.orderDetailId; let i = $index) {
                            <tr>
                                <td class="text-center text-muted">{{ i + 1 }}</td>
                                <td class="fw-medium">{{ item.dishName }}</td>
                                <td class="text-center">
                                    <div class="d-flex align-items-center justify-content-center gap-1">
                                        <!-- Nút giảm số lượng (bên trái) -->
                                        <button (click)="updateDishQuantity(item.dishId, item.quantity - 1)"
                                            class="quantity-btn decrease-btn" [disabled]="loading()">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <!-- Hiển thị số lượng (ở giữa) -->
                                        <span class="quantity-display">{{ item.quantity }}</span>
                                        <!-- Nút tăng số lượng (bên phải) -->
                                        <button (click)="updateDishQuantity(item.dishId, item.quantity + 1)"
                                            class="quantity-btn increase-btn" [disabled]="loading()">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </td>
                                <td class="text-end">{{ formatCurrency(item.unitPrice) }}</td>
                                <td class="text-end"></td>
                                <td class="text-end"></td>
                                <td class="text-end fw-semibold">{{ formatCurrency(item.totalPrice) }}</td>
                                <td class="text-center">
                                    <button (click)="removeDishFromOrder(item.dishId)" class="remove-btn"
                                        [disabled]="loading()" title="Xóa món khỏi order">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            }
        </div>

        <!-- Menu Section (50% height) -->
        <div class="menu-section">
            <div class="menu-header">
                THỰC ĐƠN
            </div>

            <!-- Category Buttons -->
            <div class="category-container">
                @for (group of dishGroups(); track group.groupName) {
                <button (click)="selectGroup(group.groupName)" [class.active]="selectedGroup() === group.groupName"
                    class="category-btn">
                    {{ group.groupName }}
                </button>
                }
            </div>

            <!-- Dishes Grid -->
            <div class="dishes-container">
                @for (group of dishGroups(); track group.groupName) {
                @if (selectedGroup() === group.groupName || selectedGroup() === '') {
                @for (dish of group.dishes; track dish.dishId) {
                <div class="dish-card" (click)="addDishToOrder(dish)">
                    <div class="dish-image">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h4 class="dish-name">{{ dish.dishName }}</h4>
                    <p class="dish-price">{{ formatCurrency(dish.basePrice) }}</p>
                </div>
                }
                }
                }
            </div>
        </div>
    </div>

    <!-- Right Panel - Customer Info + Summary (30% width) -->
    <div class="summary-panel">
        <div class="summary-header">
            <h1>THÔNG TIN HÓA ĐƠN</h1>
        </div>

        @if (order()) {
        <div class="summary-content">
            <!-- Customer Info -->
            <div class="customer-info-panel">
                <h3>Thông tin khách hàng</h3>
                <div class="customer-info-grid">
                    <div class="customer-info-item">
                        <span class="customer-info-label">Khách hàng:</span>
                        <span class="customer-info-value">{{ order()?.tableName }}</span>
                    </div>
                    <div class="customer-info-item">
                        <span class="customer-info-label">Bàn:</span>
                        <span class="customer-info-value">{{ order()?.tableCode }}</span>
                    </div>
                    <div class="customer-info-item">
                        <span class="customer-info-label">Khu vực:</span>
                        <span class="customer-info-value">{{ order()?.areaName }}</span>
                    </div>
                    <div class="customer-info-item">
                        <span class="customer-info-label">Ngày:</span>
                        <span class="customer-info-value">{{ order()?.orderDate | date:'dd/MM/yyyy HH:mm' }}</span>
                    </div>
                </div>
            </div>

            <!-- Bill Summary -->
            <div class="bill-summary">
                <h3>Tổng cộng</h3>
                <div class="bill-row">
                    <span class="bill-label">Thành tiền:</span>
                    <span class="bill-amount">{{ formatCurrency(order()?.totalAmount || 0) }}</span>
                </div>
                <div class="bill-row">
                    <span class="bill-label">Giảm giá:</span>
                    <span class="bill-amount">0</span>
                </div>
                <div class="bill-row">
                    <span class="bill-label">Thuế:</span>
                    <span class="bill-amount">0</span>
                </div>
                <div class="bill-row total">
                    <span class="bill-label">TỔNG TIỀN:</span>
                    <span class="bill-amount">{{ formatCurrency(order()?.totalAmount || 0) }}</span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn kitchen-btn">
                    <i class="fas fa-utensils mr-2"></i>
                    Gửi Nhà Bếp
                </button>
                <button class="action-btn print-btn">
                    <i class="fas fa-print mr-2"></i>
                    In Hóa Đơn
                </button>
                <button class="action-btn payment-btn">
                    <i class="fas fa-check mr-2"></i>
                    Thanh Toán
                </button>
                <button class="action-btn close-btn" (click)="onCloseTable()" [disabled]="loading()">
                    <i class="fas fa-times mr-2"></i>
                    {{ loading() ? 'Đang đóng...' : 'Đóng Bàn' }}
                </button>
            </div>
        </div>
        }
    </div>
</div>